# Default values for places-backend.
global:
  security:
    allowInsecureImages: true

image:
  repository: docker.io/vuardos/places-backend
  pullPolicy: Always # Changed to Never for local dev/kind
  tag: "latest"

replicaCount: 2

# Increased probe delays to allow dependencies to start
probes:
  liveness:
    initialDelaySeconds: 60
    periodSeconds: 20
  readiness:
    initialDelaySeconds: 30
    periodSeconds: 10
  startup:
    initialDelaySeconds: 30
    failureThreshold: 30

service:
  type: ClusterIP
  port: 8000

ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
  hosts:
    - host: api.places.internal
      paths:
        - path: /
          pathType: Prefix

resources:
  requests:
    cpu: "250m"
    memory: "768Mi"
  limits:
    cpu: "500m"
    memory: "1Gi"

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

pdb:
  enabled: true
  minAvailable: 1

# Dependencies
postgresql:
  enabled: true
  image:
    registry: public.ecr.aws
    repository: bitnami/postgresql
    tag: latest
  auth:
    database: geo_social
    username: app_user
    password: strong_password_here
  primary:
    persistence:
      enabled: true
      size: 1Gi

redis:
  enabled: true
  image:
    registry: public.ecr.aws
    repository: bitnami/redis
    tag: latest
  auth:
    password: redis_password_here
  master:
    persistence:
      enabled: true
      size: 500Mi

minio:
  enabled: true
  image:
    registry: public.ecr.aws
    repository: bitnami/minio
    tag: latest
  rootUser: minioadmin
  rootPassword: minioadmin_password
  persistence:
    enabled: true
    size: 2Gi
  console:
    image:
      registry: public.ecr.aws
      repository: bitnami/minio-object-browser
      tag: latest
  service:
    type: ClusterIP
    port: 9000

# Application Config
env:
  DB_NAME: "geo_social"
  DB_USER: "app_user"
  # DB_HOST will be generated via template based on postgresql release name
  DB_PORT: "5432"
  # REDIS_HOST will be generated via template
  REDIS_PORT: "6379"
  # MINIO_ENDPOINT will be generated via template
  MINIO_BUCKET: "places-social"
  ALGORITHM: "HS256"
  ACCESS_TOKEN_EXPIRE_MINUTES: "30"
  MINIO_SECURE: "false"

secrets:
  SECRET_KEY: "your_super_secret_key_here"
