---
# Monitoring role: Deploy monitoring stack only

- name: Ensure monitoring config directory exists and is writable by Vault Agent
  file:
    path: /opt/places_backend/deployments/configs/monitoring
    state: directory
    mode: "0777"

- name: Start monitoring stack
  shell: |
    docker compose -f /opt/places_backend/compose/docker-compose.yml \
                   -f /opt/places_backend/compose/docker-compose.monitoring.yml \
                   --env-file /opt/places_backend/.env \
                   up -d
  args:
    chdir: /opt/places_backend
  environment:
    COMPOSE_HTTP_TIMEOUT: "1000"
  no_log: true
