---
# Monitoring role: Deploy monitoring stack only

- name: Setup Alertmanager config from template
  ansible.builtin.template:
    src: alertmanager.yml.j2
    dest: /opt/places_backend/deployments/configs/monitoring/alertmanager.yml
    owner: root
    group: root
    mode: "0644"

- name: Start monitoring stack
  shell: |
    docker compose -f /opt/places_backend/compose/docker-compose.yml \
                   -f /opt/places_backend/compose/docker-compose.monitoring.yml \
                   --env-file /opt/places_backend/.env \
                   up -d
  args:
    chdir: /opt/places_backend
  async: 600
  poll: 10
  environment:
    COMPOSE_HTTP_TIMEOUT: "300"
  no_log: true
